---
title: "Provincial Netdown"
author: "Hailey Eckstrand"
date: "Last run on December 10, 2024"
output: 
  html_document:
    code_folding: hide
    # highlight: monochrome
    highlight: tango
    keep_md: yes
    theme: flatly
    toc: yes
    toc_depth: 3
    toc_float: yes
---

## Background

This report describes the data and methodology used to classify the Provincial THLB Proxy land base into four nested categories: Forest Management Land Base (FMLB), Forest Assessment Land Base (FALB), Analysis Forested Land Base (AFLB) and Timber Harvesting Land Base (THLB).

### Document setup


``` r
r_version <- R.version.string
```

This report is prepared using [RStudio](https://www.rstudio.com) and R version 4.3.2 (2023-10-31 ucrt). All necessary R package libraries have been loaded into the work environment, and the required document elements have been set up.


``` r
# load libraries:
library(knitr)
library(kableExtra)
library(tidyverse)
library(sf)
library(ggnewscale)
library(tidyterra)
library(tmap)
library(ggspatial)
library(scales)
library(cowplot)
library(mapview)
library(tidytext)
library(janitor)

rm(list = ls())

start<-Sys.time()

#knitr...read about knitr here: https://sachsmc.github.io/knit-git-markr-guide/knitr/knit.html
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
knitr::opts_chunk$set(connection = "db")
knitr::opts_knit$set(sql.max.print = NA)
knitr::opts_chunk$set(fig.width = 8.5, fig.height = 7, collapse = TRUE)
```

### Netdown process overview

The netdown process is a progressive exclusion algorithm where the BC land base is classified into four nested categories: FMLB, FALB, AFLB, and THLB:

To delineate the 4 land base categories, several deductions occur, each of which is described in detail in this document. For each deduction, two steps are followed:

1.  Categorize the area deduction in a *netdown dataframe:*
    -   The netdown dataframe includes a record for each hectare within the Province and multiple fields used to determine area deductions. For example:

    -   The FMLB, FALB, AFLB and THLB variables are updated with each area deduction. Initially, the FMLB, FALB, AFLB and THLB all have a value of one. The value gets updated with each area deduction. 

2.  Summarize the area deductions in a netdown summary table - the table summarizes area information for each area deduction:
    -   The **total** area is the gross area for the area deduction category/landclass,
    -   The **percent** is the percent of total landbase,
    -   The **excluded** value is the area that is excluded from the final THLB - the areas are excluded in the order they appear in the netdown summary table and account for areas excluded in previous deductions.
    -   The **running total** value is the combined total of excluded area for the landclass and each previous landclass identified in the table,
    -   The **netdown** is the remaining area after excluded area is removed. The final value (bottom row) is the THLB.

For example:

### Categorical vs. numerical area deduction variables

**Categorical** variables are nominal variables that describe the type of area being excluded - there is no intrinsic ordering or ranking within each categorical netdown variable. For example, the ownership description variable classifies each hectare by the excluded ownership type (e.g., private land, federal land, etc.). In the netdown dataframe, categorical variables are prefixed with "n" followed by the order in which they occur in the netdown process (e.g., n01_fmlb occurs first)

**Numerical** variables capture finer resolution (i.e. less than 100-meter resolution) area deductions and contain numeric values that define the proportion of a given hectare that will be excluded from the AFLB and THLB (e.g., 10% of a 1-hectare grid cell may be occupied by road). Numeric variable names are prefixed with "p" followed by the order in which they occur (e.g., p04_lineal_features occurs 4th in the netdown process).


## Data assembly

Prior to completing the netdown process that creates the netdown dataframe and thlb summary, pre-processing was performed to create tables that contribute to the creation of the netdown table.

### Netdown dataframe

Area deduction variables that are required to classify the land base are loaded into the netdown dataframe through a postgres query. FMLB, FALB, AFLB, and THLB variables are added to the dataframe with default values of 1. As the netdown process continues, new variables are added corresponding to each area deduction factor and the FMLB, FALB, AFLB, and THLB values are updated accordingly.

### Netdown summary table

The netdown summary table is initially created with the Provincial Boundary. As the netdown process progresses, each area deduction is appended as a new row.

**Data source:** S:\\FOR\\VIC\\HTS\\ANA\\workarea\\PROVINCIAL\\BC_Boundary_Terrestrial.tif


``` r
library(dadmtools)
library(dplyr)
library(knitr)
library(kableExtra)
library(tidyverse)
source('../utils/functions.R')

conn_list <- dadmtools::get_pg_conn_list()
query <- "	SELECT 
  gr_skey,
  own,
	n01_fmlb,
	n02_ownership,
	n03_ownership,
	n04_nonfor,
	p05_linear_features,
	p06_riparian,
	p07_phys_inop,
	n08_merchantability
FROM thlb_proxy.prov_netdown net"
netdown_tab <- sql_to_df(query, conn_list)
netdown_summary <- setup_tracking_variable(netdown_tab)
running_total <- 0
pretty_table(netdown_summary)
```

<table class="table table-striped" style="font-size: 10px; color: black; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">Netdown Summary Table</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> landclass </th>
   <th style="text-align:right;"> total </th>
   <th style="text-align:right;"> percent </th>
   <th style="text-align:right;"> excluded </th>
   <th style="text-align:right;"> running_total </th>
   <th style="text-align:right;"> netdown </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Provincial_Boundary </td>
   <td style="text-align:right;"> 94,806,032 </td>
   <td style="text-align:right;"> 100 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 94,806,032 </td>
  </tr>
</tbody>
</table>




## Netdown steps

Each netdown step (area deduction) is described in the following sub-sections.

## Delineating the FMLB

The following area deductions are removed from the Provincial Boundary area to classify the FMLB. FMLB Logic:

Legend:  

- 'N': non forested 
- 'Y': forested 

Description:

+ 'N' if BEC.natural_disturbance = 'NDT5'
+ 'Y' if harvest IS TRUE, (harvest is defined as: harvest is TRUE if vri.harvest_date is not null OR consolidated cutblocks exist OR vri.opening_id or vri.opening_number IS NOT NULL or '0' otherwise 'N')
+ 'Y' if (vri.bclcs_level_1 IN ('U', '') AND btm.present_land_use_label in ('Old Forest', 'Recently Logged', 'Selectively Logged', 'Young Forest'))
+ 'N' if bclcs_level_1 = 'V' AND bclcs_level_2 <> 'T' and vri.project NOT LIKE 'FIRE_UPDATE%'
+ 'N' if URBAN is true AND vri.for_mgmt_land_base_ind = 'Y', (URBAN defined as: URBAN IS TRUE if vri.non_productive_descriptor_cd = 'U' OR vri.bclcs_level_5 = 'UR' OR vri.land_cover_class_cd_1 = 'UR' OR vri.land_cover_class_cd_2 = 'UR' vri.OR land_cover_class_cd_3 = 'UR')
+ OTHERWISE vri.for_mgmt_land_base_ind

Code:
The following logic is used to derive the `for_mgmt_land_base_ind` field.



``` sql
WITH recreate_for_mgmt_land_base_ind AS (
SELECT
  CASE
      -- when harvest does not exist
      WHEN (nullif(v.opening_id::text,'0') IS NULL AND nullif(v.opening_number::text,'0') IS NULL AND v.harvest_date IS NULL)
      -- AND
      AND
      -- inventory code = Forest Inventory Planning (FIP);
      -- AND is non productive or unreported
      -- OR
        (
        (
          v.inventory_standard_cd = 'F' 
          AND
          (
          (v.non_productive_cd IS NOT NULL AND v.non_productive_cd <> '00') 
          OR
            (v.non_productive_descriptor_cd IS NOT NULL AND v.non_productive_descriptor_cd <> '00') 
          OR
            v.bclcs_level_1 = 'U'
          )
        )
      -- inventory code != Forest Inventory Planning (FIP);
      -- AND land cover classification either non-vegetated or unreported
      -- OR
      OR
        (
          v.inventory_standard_cd IN ('V', 'I', 'L') 
          AND 
          (
            v.bclcs_level_1 In ('N', 'U')
            OR
            v.bclcs_level_3 = 'A'
          )
        )
      OR
      -- site_index < 5
        (
          COALESCE(COALESCE(v.site_index, v.est_site_index),0) < 5
        )
        )
      then
        'N'
      else
        'Y'
    END fmlb_initial,
    inventory_standard_cd,
    earliest_nonlogging_dist_type,
    crown_closure,
    site_index,
    bclcs_level_1,
    bclcs_level_2,
    bclcs_level_3,
    project
FROM
  whse.veg_comp_lyr_r1_poly_internal_2023 v
)
SELECT
-- Some Fire Update polygons are flipped back from N to Y if they fall into the following pattern:
	CASE WHEN project ilike 'FIRE_UPDATE%' 
		AND inventory_standard_cd = 'V' 
		AND earliest_nonlogging_dist_type like 'B%' 
		AND crown_closure < 5
		AND site_index >= 5
		AND bclcs_level_1 = 'N'
		AND bclcs_level_2 = 'L'
		AND bclcs_level_3 = 'U'
		AND fmlb_initial = 'N'
	THEN 'Y' 
	ELSE fmlb_initial
	END AS fmlb_recreate
FROM
recreate_for_mgmt_land_base_ind;
```

**Data sources:** WHSE_FOREST_VEGETATION.VEG_COMP_LYR_R1_POLY, WHSE_FOREST_VEGETATION.VEG_CONSOLIDATED_CUT_BLOCKS_SP, WHSE_BASEMAPPING.BTM_PRESENT_LAND_USE_V1_SVW, WHSE_FOREST_VEGETATION.BEC_BIOGEOCLIMATIC_POLY



``` r
netdown_tab <- netdown_tab %>%
  mutate(
    fmlb = 1,
    falb = 1,
    aflb = 1,
    thlb_net = 1
  )

lclass<-"FMLB"
n_step<-"n01_fmlb"

netdown_summary <- netdown100pct(netdown_tab,netdown_summary,running_total,lclass,n_step)
netdown_tab <- update_areas_fmlb(netdown_tab,n_step)
running_total <- get_running_total(netdown_summary,lclass)
netdown <- get_netdown(netdown_summary,lclass)

pretty_table(netdown_summary)
```

<table class="table table-striped" style="font-size: 10px; color: black; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">Netdown Summary Table</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> landclass </th>
   <th style="text-align:right;"> total </th>
   <th style="text-align:right;"> percent </th>
   <th style="text-align:right;"> excluded </th>
   <th style="text-align:right;"> running_total </th>
   <th style="text-align:right;"> netdown </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Provincial_Boundary </td>
   <td style="text-align:right;"> 94,806,032 </td>
   <td style="text-align:right;"> 100.00000 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 94,806,032 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> FMLB </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 38.59727 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 58,213,491 </td>
  </tr>
</tbody>
</table>




### FMLB Summary


``` r
lclass<-"LANDBASE SUMMARY - FMLB"

netdown_summary <- landbase_sum(netdown_tab,netdown_summary,running_total,lclass,netdown,which_landbase=fmlb)

pretty_table(netdown_summary)
```

<table class="table table-striped" style="font-size: 10px; color: black; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">Netdown Summary Table</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> landclass </th>
   <th style="text-align:right;"> total </th>
   <th style="text-align:right;"> percent </th>
   <th style="text-align:right;"> excluded </th>
   <th style="text-align:right;"> running_total </th>
   <th style="text-align:right;"> netdown </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Provincial_Boundary </td>
   <td style="text-align:right;"> 94,806,032 </td>
   <td style="text-align:right;"> 100.00000 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 94,806,032 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> FMLB </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 38.59727 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 58,213,491 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LANDBASE SUMMARY - FMLB </td>
   <td style="text-align:right;"> 58,213,491 </td>
   <td style="text-align:right;"> 61.40273 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 58,213,491 </td>
  </tr>
</tbody>
</table>




## Delineating the FALB

The following area deductions are removed from the FMLB to classify the FALB

## n02_ownership

The next phase of the netdown process delineates the FALB from the FMLB. The FALB excludes private, municipal and first nation reserve lands. Below is a specific list of ownership classes excluded:

+ 40N, Private, - Parcel has a title registered to a First Nations group
+ 41N, Private - Land Claim Settlement Area
+ 52N, Federal - Indian Reserve
+ 80N, Crown Municipal Parcels



``` r

lclass<-"Ownership_Areas_Excluded_from_FALB"
n_step<-"n02_ownership"

netdown_summary<-netdown100pct(netdown_tab,netdown_summary,running_total,lclass,n_step)
netdown_tab<-update_areas_falb(netdown_tab,n_step)
running_total<-get_running_total(netdown_summary,lclass)
netdown <- get_netdown(netdown_summary,lclass)
pretty_table(netdown_summary)
```

<table class="table table-striped" style="font-size: 10px; color: black; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">Netdown Summary Table</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> landclass </th>
   <th style="text-align:right;"> total </th>
   <th style="text-align:right;"> percent </th>
   <th style="text-align:right;"> excluded </th>
   <th style="text-align:right;"> running_total </th>
   <th style="text-align:right;"> netdown </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Provincial_Boundary </td>
   <td style="text-align:right;"> 94,806,032 </td>
   <td style="text-align:right;"> 100.000000 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 94,806,032 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> FMLB </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 38.597271 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 58,213,491 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LANDBASE SUMMARY - FMLB </td>
   <td style="text-align:right;"> 58,213,491 </td>
   <td style="text-align:right;"> 61.402729 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 58,213,491 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Ownership_Areas_Excluded_from_FALB </td>
   <td style="text-align:right;"> 4,887,226 </td>
   <td style="text-align:right;"> 5.154974 </td>
   <td style="text-align:right;"> 2,749,448 </td>
   <td style="text-align:right;"> 39,341,989 </td>
   <td style="text-align:right;"> 55,464,043 </td>
  </tr>
</tbody>
</table>



### FALB Summary


``` r

lclass<-"LANDBASE SUMMARY - FALB"

netdown_summary <- landbase_sum(netdown_tab,netdown_summary,running_total,lclass,netdown,which_landbase=falb)

pretty_table(netdown_summary)
```

<table class="table table-striped" style="font-size: 10px; color: black; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">Netdown Summary Table</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> landclass </th>
   <th style="text-align:right;"> total </th>
   <th style="text-align:right;"> percent </th>
   <th style="text-align:right;"> excluded </th>
   <th style="text-align:right;"> running_total </th>
   <th style="text-align:right;"> netdown </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Provincial_Boundary </td>
   <td style="text-align:right;"> 94,806,032 </td>
   <td style="text-align:right;"> 100.000000 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 94,806,032 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> FMLB </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 38.597271 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 58,213,491 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LANDBASE SUMMARY - FMLB </td>
   <td style="text-align:right;"> 58,213,491 </td>
   <td style="text-align:right;"> 61.402729 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 58,213,491 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Ownership_Areas_Excluded_from_FALB </td>
   <td style="text-align:right;"> 4,887,226 </td>
   <td style="text-align:right;"> 5.154974 </td>
   <td style="text-align:right;"> 2,749,448 </td>
   <td style="text-align:right;"> 39,341,989 </td>
   <td style="text-align:right;"> 55,464,043 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LANDBASE SUMMARY - FALB </td>
   <td style="text-align:right;"> 55,464,043 </td>
   <td style="text-align:right;"> 58.502652 </td>
   <td style="text-align:right;"> 39,341,989 </td>
   <td style="text-align:right;"> 39,341,989 </td>
   <td style="text-align:right;"> 55,464,043 </td>
  </tr>
</tbody>
</table>



## Delineating the AFLB

The following area deductions are removed from the FALB to classify the AFLB

### n03_ownership

The next phase of the netdown process delineates the AFLB from the FALB. 
The FALB excludes the remaining federal lands. Below is a specific list of ownership classes excluded:

+ 50N, Federal - Federal Reserve
+ 51N, Federal - National Park
+ 53N, Federal - Military Reserve
+ 54N, Federal - Dominion government Block/Federal Parcels



``` r

lclass<-"Ownership_Areas_Excluded_from_AFLB"
n_step<-"n03_ownership"

netdown_summary<-netdown100pct(netdown_tab,netdown_summary,running_total,lclass,n_step)
netdown_tab<-update_areas_aflb(netdown_tab,n_step)
running_total<-get_running_total(netdown_summary,lclass)
netdown <- get_netdown(netdown_summary,lclass)

pretty_table(netdown_summary)
```

<table class="table table-striped" style="font-size: 10px; color: black; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">Netdown Summary Table</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> landclass </th>
   <th style="text-align:right;"> total </th>
   <th style="text-align:right;"> percent </th>
   <th style="text-align:right;"> excluded </th>
   <th style="text-align:right;"> running_total </th>
   <th style="text-align:right;"> netdown </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Provincial_Boundary </td>
   <td style="text-align:right;"> 94,806,032 </td>
   <td style="text-align:right;"> 100.000000 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 94,806,032 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> FMLB </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 38.597271 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 58,213,491 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LANDBASE SUMMARY - FMLB </td>
   <td style="text-align:right;"> 58,213,491 </td>
   <td style="text-align:right;"> 61.402729 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 58,213,491 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Ownership_Areas_Excluded_from_FALB </td>
   <td style="text-align:right;"> 4,887,226 </td>
   <td style="text-align:right;"> 5.154974 </td>
   <td style="text-align:right;"> 2,749,448 </td>
   <td style="text-align:right;"> 39,341,989 </td>
   <td style="text-align:right;"> 55,464,043 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LANDBASE SUMMARY - FALB </td>
   <td style="text-align:right;"> 55,464,043 </td>
   <td style="text-align:right;"> 58.502652 </td>
   <td style="text-align:right;"> 39,341,989 </td>
   <td style="text-align:right;"> 39,341,989 </td>
   <td style="text-align:right;"> 55,464,043 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Ownership_Areas_Excluded_from_AFLB </td>
   <td style="text-align:right;"> 668,209 </td>
   <td style="text-align:right;"> 0.704817 </td>
   <td style="text-align:right;"> 403,404 </td>
   <td style="text-align:right;"> 39,745,393 </td>
   <td style="text-align:right;"> 55,060,639 </td>
  </tr>
</tbody>
</table>




### n04_nonfor

The FALB land base is further excluded to create a 'not forested or non productive forest'.  These land cover types are not expected to contribute to either timber supply or non-timber management objectives that are based on forested conditions. Attributes that identify non-vegetated and various classes of vegetated areas are classified based on the BC land classification system (BCLCS), the Freshwater Atlas and the Biogeoclimatic Ecosystem Classification (BEC). Areas within historic cutblocks are considered forested and contribute to the THLB except where noted below.

Identifying non-forest/non-productive is done using a long 'case when' statement in a previous postgres table creation. In the netdown table each non-productive class is assigned it’s own descriptive label under the variable n04_nonfor.

**Data sources:** WHSE_FOREST_VEGETATION.VEG_COMP_LYR_R1_POLY, WHSE_FOREST_VEGETATION.VEG_CONSOLIDATED_CUT_BLOCKS_SP, WHSE_BASEMAPPING.FWA_WETLANDS_POLY


``` r
lclass<-"Non_Forest_and_Non_Productive_Forest"
n_step<-"n04_nonfor"

netdown_summary<-netdown100pct(netdown_tab,netdown_summary,running_total,lclass,n_step)

netdown_tab<-update_areas_aflb(netdown_tab,n_step)

running_total<-get_running_total(netdown_summary,lclass)

pretty_table(netdown_summary)
```

<table class="table table-striped" style="font-size: 10px; color: black; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">Netdown Summary Table</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> landclass </th>
   <th style="text-align:right;"> total </th>
   <th style="text-align:right;"> percent </th>
   <th style="text-align:right;"> excluded </th>
   <th style="text-align:right;"> running_total </th>
   <th style="text-align:right;"> netdown </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Provincial_Boundary </td>
   <td style="text-align:right;"> 94,806,032 </td>
   <td style="text-align:right;"> 100.000000 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 94,806,032 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> FMLB </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 38.597271 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 58,213,491 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LANDBASE SUMMARY - FMLB </td>
   <td style="text-align:right;"> 58,213,491 </td>
   <td style="text-align:right;"> 61.402729 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 58,213,491 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Ownership_Areas_Excluded_from_FALB </td>
   <td style="text-align:right;"> 4,887,226 </td>
   <td style="text-align:right;"> 5.154974 </td>
   <td style="text-align:right;"> 2,749,448 </td>
   <td style="text-align:right;"> 39,341,989 </td>
   <td style="text-align:right;"> 55,464,043 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LANDBASE SUMMARY - FALB </td>
   <td style="text-align:right;"> 55,464,043 </td>
   <td style="text-align:right;"> 58.502652 </td>
   <td style="text-align:right;"> 39,341,989 </td>
   <td style="text-align:right;"> 39,341,989 </td>
   <td style="text-align:right;"> 55,464,043 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Ownership_Areas_Excluded_from_AFLB </td>
   <td style="text-align:right;"> 668,209 </td>
   <td style="text-align:right;"> 0.704817 </td>
   <td style="text-align:right;"> 403,404 </td>
   <td style="text-align:right;"> 39,745,393 </td>
   <td style="text-align:right;"> 55,060,639 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Non_Forest_and_Non_Productive_Forest </td>
   <td style="text-align:right;"> 40,054,531 </td>
   <td style="text-align:right;"> 42.248927 </td>
   <td style="text-align:right;"> 4,306,612 </td>
   <td style="text-align:right;"> 44,052,005 </td>
   <td style="text-align:right;"> 50,754,027 </td>
  </tr>
</tbody>
</table>



### p05_linear_features

Productive forest land is lost due to permanent roads, trails, pipelines, transmission lines and other linear features (something relating to or consisting of lines (buffered)). Existing estimates of the area occupied by linear features is determined by applying average feature width buffers to the identified features.

The linear features table was created in July 2024 and reflects the 2021 CE Integrated roads dataset that includes roads and other linear features (railways, power lines, etc.). 

**Data source:** BC cumulative effects framework 2021 integrated roads dataset, WHSE_TANTALIS.TA_CROWN_RIGHTS_OF_WAY_SVW, WHSE_MINERAL_TENURE.OG_PIPELINE_AREA_PERMIT_SP, WHSE_IMAGERY_AND_BASE_MAPS.DRP_OIL_GAS_PIPELINES_BC_SP, WHSE_BASEMAPPING.GBA_TRANSMISSION_LINES_SP, WHSE_BASEMAPPING.GBA_RAILWAY_TRACKS_SP



``` r
lclass<-"Linear_Features"
n_step<-"p05_linear_features"

netdown_summary<-netdown_prop(netdown_tab,netdown_summary,running_total,lclass,n_step)


netdown_tab <- netdown_tab %>%
mutate( aflb = aflb * (1-p05_linear_features),
thlb_net = thlb_net * (1-p05_linear_features)
)

running_total<-get_running_total(netdown_summary,lclass)

netdown<-get_netdown(netdown_summary,lclass)
pretty_table(netdown_summary)
```

<table class="table table-striped" style="font-size: 10px; color: black; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">Netdown Summary Table</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> landclass </th>
   <th style="text-align:right;"> total </th>
   <th style="text-align:right;"> percent </th>
   <th style="text-align:right;"> excluded </th>
   <th style="text-align:right;"> running_total </th>
   <th style="text-align:right;"> netdown </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Provincial_Boundary </td>
   <td style="text-align:right;"> 94,806,032 </td>
   <td style="text-align:right;"> 100.000000 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 94,806,032 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> FMLB </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 38.597271 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 58,213,491 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LANDBASE SUMMARY - FMLB </td>
   <td style="text-align:right;"> 58,213,491 </td>
   <td style="text-align:right;"> 61.402729 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 58,213,491 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Ownership_Areas_Excluded_from_FALB </td>
   <td style="text-align:right;"> 4,887,226 </td>
   <td style="text-align:right;"> 5.154974 </td>
   <td style="text-align:right;"> 2,749,448 </td>
   <td style="text-align:right;"> 39,341,989 </td>
   <td style="text-align:right;"> 55,464,043 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LANDBASE SUMMARY - FALB </td>
   <td style="text-align:right;"> 55,464,043 </td>
   <td style="text-align:right;"> 58.502652 </td>
   <td style="text-align:right;"> 39,341,989 </td>
   <td style="text-align:right;"> 39,341,989 </td>
   <td style="text-align:right;"> 55,464,043 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Ownership_Areas_Excluded_from_AFLB </td>
   <td style="text-align:right;"> 668,209 </td>
   <td style="text-align:right;"> 0.704817 </td>
   <td style="text-align:right;"> 403,404 </td>
   <td style="text-align:right;"> 39,745,393 </td>
   <td style="text-align:right;"> 55,060,639 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Non_Forest_and_Non_Productive_Forest </td>
   <td style="text-align:right;"> 40,054,531 </td>
   <td style="text-align:right;"> 42.248927 </td>
   <td style="text-align:right;"> 4,306,612 </td>
   <td style="text-align:right;"> 44,052,005 </td>
   <td style="text-align:right;"> 50,754,027 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Linear_Features </td>
   <td style="text-align:right;"> 1,727,381 </td>
   <td style="text-align:right;"> 1.822016 </td>
   <td style="text-align:right;"> 1,119,885 </td>
   <td style="text-align:right;"> 45,171,890 </td>
   <td style="text-align:right;"> 49,634,142 </td>
  </tr>
</tbody>
</table>



### AFLB Summary


``` r
lclass<-"LANDBASE SUMMARY - AFLB"

netdown_summary<-landbase_sum(netdown_tab,netdown_summary,running_total,lclass,netdown,which_landbase=aflb)

pretty_table(netdown_summary)
```

<table class="table table-striped" style="font-size: 10px; color: black; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">Netdown Summary Table</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> landclass </th>
   <th style="text-align:right;"> total </th>
   <th style="text-align:right;"> percent </th>
   <th style="text-align:right;"> excluded </th>
   <th style="text-align:right;"> running_total </th>
   <th style="text-align:right;"> netdown </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Provincial_Boundary </td>
   <td style="text-align:right;"> 94,806,032 </td>
   <td style="text-align:right;"> 100.000000 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 94,806,032 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> FMLB </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 38.597271 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 58,213,491 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LANDBASE SUMMARY - FMLB </td>
   <td style="text-align:right;"> 58,213,491 </td>
   <td style="text-align:right;"> 61.402729 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 58,213,491 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Ownership_Areas_Excluded_from_FALB </td>
   <td style="text-align:right;"> 4,887,226 </td>
   <td style="text-align:right;"> 5.154974 </td>
   <td style="text-align:right;"> 2,749,448 </td>
   <td style="text-align:right;"> 39,341,989 </td>
   <td style="text-align:right;"> 55,464,043 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LANDBASE SUMMARY - FALB </td>
   <td style="text-align:right;"> 55,464,043 </td>
   <td style="text-align:right;"> 58.502652 </td>
   <td style="text-align:right;"> 39,341,989 </td>
   <td style="text-align:right;"> 39,341,989 </td>
   <td style="text-align:right;"> 55,464,043 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Ownership_Areas_Excluded_from_AFLB </td>
   <td style="text-align:right;"> 668,209 </td>
   <td style="text-align:right;"> 0.704817 </td>
   <td style="text-align:right;"> 403,404 </td>
   <td style="text-align:right;"> 39,745,393 </td>
   <td style="text-align:right;"> 55,060,639 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Non_Forest_and_Non_Productive_Forest </td>
   <td style="text-align:right;"> 40,054,531 </td>
   <td style="text-align:right;"> 42.248927 </td>
   <td style="text-align:right;"> 4,306,612 </td>
   <td style="text-align:right;"> 44,052,005 </td>
   <td style="text-align:right;"> 50,754,027 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Linear_Features </td>
   <td style="text-align:right;"> 1,727,381 </td>
   <td style="text-align:right;"> 1.822016 </td>
   <td style="text-align:right;"> 1,119,885 </td>
   <td style="text-align:right;"> 45,171,890 </td>
   <td style="text-align:right;"> 49,634,142 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LANDBASE SUMMARY - AFLB </td>
   <td style="text-align:right;"> 49,634,142 </td>
   <td style="text-align:right;"> 52.353359 </td>
   <td style="text-align:right;"> 45,171,890 </td>
   <td style="text-align:right;"> 45,171,890 </td>
   <td style="text-align:right;"> 49,634,142 </td>
  </tr>
</tbody>
</table>



## Write to Postgres


``` r

df_to_pg(Id(schema = 'thlb_proxy', table = 'netdown_fmlb_falb_aflb'), netdown_tab[,c('gr_skey', 'fmlb', 'falb', 'aflb')], conn_list, overwrite=TRUE)
```

## Delineating the THLB

The next phase of the netdown process delineates the THLB from the AFLB. 

### p06_riparian


``` r
lclass<-"Riparian_Buffers"
n_step<-"p06_riparian"

netdown_summary<-netdown_prop(netdown_tab,netdown_summary,running_total,lclass,n_step)

netdown_tab <- netdown_tab %>%
  mutate(thlb_net = thlb_net * (1-p06_riparian)
  )

running_total<-get_running_total(netdown_summary,lclass)
netdown<-get_netdown(netdown_summary,lclass)
pretty_table(netdown_summary)
```

<table class="table table-striped" style="font-size: 10px; color: black; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">Netdown Summary Table</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> landclass </th>
   <th style="text-align:right;"> total </th>
   <th style="text-align:right;"> percent </th>
   <th style="text-align:right;"> excluded </th>
   <th style="text-align:right;"> running_total </th>
   <th style="text-align:right;"> netdown </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Provincial_Boundary </td>
   <td style="text-align:right;"> 94,806,032 </td>
   <td style="text-align:right;"> 100.000000 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 94,806,032 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> FMLB </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 38.597271 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 58,213,491 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LANDBASE SUMMARY - FMLB </td>
   <td style="text-align:right;"> 58,213,491 </td>
   <td style="text-align:right;"> 61.402729 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 58,213,491 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Ownership_Areas_Excluded_from_FALB </td>
   <td style="text-align:right;"> 4,887,226 </td>
   <td style="text-align:right;"> 5.154974 </td>
   <td style="text-align:right;"> 2,749,448 </td>
   <td style="text-align:right;"> 39,341,989 </td>
   <td style="text-align:right;"> 55,464,043 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LANDBASE SUMMARY - FALB </td>
   <td style="text-align:right;"> 55,464,043 </td>
   <td style="text-align:right;"> 58.502652 </td>
   <td style="text-align:right;"> 39,341,989 </td>
   <td style="text-align:right;"> 39,341,989 </td>
   <td style="text-align:right;"> 55,464,043 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Ownership_Areas_Excluded_from_AFLB </td>
   <td style="text-align:right;"> 668,209 </td>
   <td style="text-align:right;"> 0.704817 </td>
   <td style="text-align:right;"> 403,404 </td>
   <td style="text-align:right;"> 39,745,393 </td>
   <td style="text-align:right;"> 55,060,639 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Non_Forest_and_Non_Productive_Forest </td>
   <td style="text-align:right;"> 40,054,531 </td>
   <td style="text-align:right;"> 42.248927 </td>
   <td style="text-align:right;"> 4,306,612 </td>
   <td style="text-align:right;"> 44,052,005 </td>
   <td style="text-align:right;"> 50,754,027 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Linear_Features </td>
   <td style="text-align:right;"> 1,727,381 </td>
   <td style="text-align:right;"> 1.822016 </td>
   <td style="text-align:right;"> 1,119,885 </td>
   <td style="text-align:right;"> 45,171,890 </td>
   <td style="text-align:right;"> 49,634,142 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LANDBASE SUMMARY - AFLB </td>
   <td style="text-align:right;"> 49,634,142 </td>
   <td style="text-align:right;"> 52.353359 </td>
   <td style="text-align:right;"> 45,171,890 </td>
   <td style="text-align:right;"> 45,171,890 </td>
   <td style="text-align:right;"> 49,634,142 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Riparian_Buffers </td>
   <td style="text-align:right;"> 28,298,289 </td>
   <td style="text-align:right;"> 29.848617 </td>
   <td style="text-align:right;"> 2,563,383 </td>
   <td style="text-align:right;"> 47,735,273 </td>
   <td style="text-align:right;"> 47,070,759 </td>
  </tr>
</tbody>
</table>



### p07_phys_inop
To determine physically inoperable areas, elevation, slope and terrain stability mapping were assessed related to historic practice since 2014. 

For each TSA and TFL, binary rasters at 25-meter resolution were created to identify areas with slopes exceeding the 99th percentile within harvested cutblocks since 2014, areas with elevations exceeding 99th percentile within harvested cutblocks since 2014 and areas with unstable or potentially unstable slopes. These rasters were then combined to produce a single "physically inoperable" variable. Finally, the data was aggregated to a 1-hectare resolution to form a proportional inoperable variable.

Please note that when creating the 99th percentile threshold, it was required to have a minumum of 30 cutblocks within the TFL/TSA. If the unit did not have > 30 cutblocks, a TFL would using the threshold of the TSA the TFL overlaps with the most. Only TFL 43 had < 30 cutblocks, and instead, the thresolds from 39 - Sunshine Coast TSA were used for TFL 43.


``` r
lclass<-"Physical_Inoperable"
n_step<-"p07_phys_inop"

netdown_summary<-netdown_prop(netdown_tab,netdown_summary,running_total,lclass,n_step)

netdown_tab <- netdown_tab %>%
  mutate(thlb_net = thlb_net * (1-p07_phys_inop)
  )

running_total<-get_running_total(netdown_summary,lclass)
pretty_table(netdown_summary)
```

<table class="table table-striped" style="font-size: 10px; color: black; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">Netdown Summary Table</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> landclass </th>
   <th style="text-align:right;"> total </th>
   <th style="text-align:right;"> percent </th>
   <th style="text-align:right;"> excluded </th>
   <th style="text-align:right;"> running_total </th>
   <th style="text-align:right;"> netdown </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Provincial_Boundary </td>
   <td style="text-align:right;"> 94,806,032 </td>
   <td style="text-align:right;"> 100.000000 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 94,806,032 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> FMLB </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 38.597271 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 58,213,491 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LANDBASE SUMMARY - FMLB </td>
   <td style="text-align:right;"> 58,213,491 </td>
   <td style="text-align:right;"> 61.402729 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 58,213,491 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Ownership_Areas_Excluded_from_FALB </td>
   <td style="text-align:right;"> 4,887,226 </td>
   <td style="text-align:right;"> 5.154974 </td>
   <td style="text-align:right;"> 2,749,448 </td>
   <td style="text-align:right;"> 39,341,989 </td>
   <td style="text-align:right;"> 55,464,043 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LANDBASE SUMMARY - FALB </td>
   <td style="text-align:right;"> 55,464,043 </td>
   <td style="text-align:right;"> 58.502652 </td>
   <td style="text-align:right;"> 39,341,989 </td>
   <td style="text-align:right;"> 39,341,989 </td>
   <td style="text-align:right;"> 55,464,043 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Ownership_Areas_Excluded_from_AFLB </td>
   <td style="text-align:right;"> 668,209 </td>
   <td style="text-align:right;"> 0.704817 </td>
   <td style="text-align:right;"> 403,404 </td>
   <td style="text-align:right;"> 39,745,393 </td>
   <td style="text-align:right;"> 55,060,639 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Non_Forest_and_Non_Productive_Forest </td>
   <td style="text-align:right;"> 40,054,531 </td>
   <td style="text-align:right;"> 42.248927 </td>
   <td style="text-align:right;"> 4,306,612 </td>
   <td style="text-align:right;"> 44,052,005 </td>
   <td style="text-align:right;"> 50,754,027 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Linear_Features </td>
   <td style="text-align:right;"> 1,727,381 </td>
   <td style="text-align:right;"> 1.822016 </td>
   <td style="text-align:right;"> 1,119,885 </td>
   <td style="text-align:right;"> 45,171,890 </td>
   <td style="text-align:right;"> 49,634,142 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LANDBASE SUMMARY - AFLB </td>
   <td style="text-align:right;"> 49,634,142 </td>
   <td style="text-align:right;"> 52.353359 </td>
   <td style="text-align:right;"> 45,171,890 </td>
   <td style="text-align:right;"> 45,171,890 </td>
   <td style="text-align:right;"> 49,634,142 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Riparian_Buffers </td>
   <td style="text-align:right;"> 28,298,289 </td>
   <td style="text-align:right;"> 29.848617 </td>
   <td style="text-align:right;"> 2,563,383 </td>
   <td style="text-align:right;"> 47,735,273 </td>
   <td style="text-align:right;"> 47,070,759 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Physical_Inoperable </td>
   <td style="text-align:right;"> 29,871,235 </td>
   <td style="text-align:right;"> 31.507737 </td>
   <td style="text-align:right;"> 10,127,617 </td>
   <td style="text-align:right;"> 57,862,890 </td>
   <td style="text-align:right;"> 36,943,142 </td>
  </tr>
</tbody>
</table>



### n08_merchantability


``` r
lclass<-"Merchantability"
n_step<-"n08_merchantability"

netdown_summary<-netdown100pct(netdown_tab,netdown_summary,running_total,lclass,n_step)
netdown_tab<-update_areas_thlb(netdown_tab,n_step)
running_total<-get_running_total(netdown_summary,lclass)
netdown<-get_netdown(netdown_summary,lclass)
pretty_table(netdown_summary)
```

<table class="table table-striped" style="font-size: 10px; color: black; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">Netdown Summary Table</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> landclass </th>
   <th style="text-align:right;"> total </th>
   <th style="text-align:right;"> percent </th>
   <th style="text-align:right;"> excluded </th>
   <th style="text-align:right;"> running_total </th>
   <th style="text-align:right;"> netdown </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Provincial_Boundary </td>
   <td style="text-align:right;"> 94,806,032 </td>
   <td style="text-align:right;"> 100.000000 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 94,806,032 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> FMLB </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 38.597271 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 58,213,491 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LANDBASE SUMMARY - FMLB </td>
   <td style="text-align:right;"> 58,213,491 </td>
   <td style="text-align:right;"> 61.402729 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 58,213,491 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Ownership_Areas_Excluded_from_FALB </td>
   <td style="text-align:right;"> 4,887,226 </td>
   <td style="text-align:right;"> 5.154974 </td>
   <td style="text-align:right;"> 2,749,448 </td>
   <td style="text-align:right;"> 39,341,989 </td>
   <td style="text-align:right;"> 55,464,043 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LANDBASE SUMMARY - FALB </td>
   <td style="text-align:right;"> 55,464,043 </td>
   <td style="text-align:right;"> 58.502652 </td>
   <td style="text-align:right;"> 39,341,989 </td>
   <td style="text-align:right;"> 39,341,989 </td>
   <td style="text-align:right;"> 55,464,043 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Ownership_Areas_Excluded_from_AFLB </td>
   <td style="text-align:right;"> 668,209 </td>
   <td style="text-align:right;"> 0.704817 </td>
   <td style="text-align:right;"> 403,404 </td>
   <td style="text-align:right;"> 39,745,393 </td>
   <td style="text-align:right;"> 55,060,639 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Non_Forest_and_Non_Productive_Forest </td>
   <td style="text-align:right;"> 40,054,531 </td>
   <td style="text-align:right;"> 42.248927 </td>
   <td style="text-align:right;"> 4,306,612 </td>
   <td style="text-align:right;"> 44,052,005 </td>
   <td style="text-align:right;"> 50,754,027 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Linear_Features </td>
   <td style="text-align:right;"> 1,727,381 </td>
   <td style="text-align:right;"> 1.822016 </td>
   <td style="text-align:right;"> 1,119,885 </td>
   <td style="text-align:right;"> 45,171,890 </td>
   <td style="text-align:right;"> 49,634,142 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LANDBASE SUMMARY - AFLB </td>
   <td style="text-align:right;"> 49,634,142 </td>
   <td style="text-align:right;"> 52.353359 </td>
   <td style="text-align:right;"> 45,171,890 </td>
   <td style="text-align:right;"> 45,171,890 </td>
   <td style="text-align:right;"> 49,634,142 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Riparian_Buffers </td>
   <td style="text-align:right;"> 28,298,289 </td>
   <td style="text-align:right;"> 29.848617 </td>
   <td style="text-align:right;"> 2,563,383 </td>
   <td style="text-align:right;"> 47,735,273 </td>
   <td style="text-align:right;"> 47,070,759 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Physical_Inoperable </td>
   <td style="text-align:right;"> 29,871,235 </td>
   <td style="text-align:right;"> 31.507737 </td>
   <td style="text-align:right;"> 10,127,617 </td>
   <td style="text-align:right;"> 57,862,890 </td>
   <td style="text-align:right;"> 36,943,142 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Merchantability </td>
   <td style="text-align:right;"> 23,088,348 </td>
   <td style="text-align:right;"> 24.353248 </td>
   <td style="text-align:right;"> 6,267,020 </td>
   <td style="text-align:right;"> 64,129,911 </td>
   <td style="text-align:right;"> 30,676,121 </td>
  </tr>
</tbody>
</table>




### THLB Summary


``` r
lclass<-"LANDBASE SUMMARY - THLB"

netdown_summary<-landbase_sum(netdown_tab,netdown_summary,running_total,lclass,netdown,which_landbase=thlb_net)

pretty_table(netdown_summary)
```

<table class="table table-striped" style="font-size: 10px; color: black; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">Netdown Summary Table</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> landclass </th>
   <th style="text-align:right;"> total </th>
   <th style="text-align:right;"> percent </th>
   <th style="text-align:right;"> excluded </th>
   <th style="text-align:right;"> running_total </th>
   <th style="text-align:right;"> netdown </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Provincial_Boundary </td>
   <td style="text-align:right;"> 94,806,032 </td>
   <td style="text-align:right;"> 100.000000 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 94,806,032 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> FMLB </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 38.597271 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 58,213,491 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LANDBASE SUMMARY - FMLB </td>
   <td style="text-align:right;"> 58,213,491 </td>
   <td style="text-align:right;"> 61.402729 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 36,592,541 </td>
   <td style="text-align:right;"> 58,213,491 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Ownership_Areas_Excluded_from_FALB </td>
   <td style="text-align:right;"> 4,887,226 </td>
   <td style="text-align:right;"> 5.154974 </td>
   <td style="text-align:right;"> 2,749,448 </td>
   <td style="text-align:right;"> 39,341,989 </td>
   <td style="text-align:right;"> 55,464,043 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LANDBASE SUMMARY - FALB </td>
   <td style="text-align:right;"> 55,464,043 </td>
   <td style="text-align:right;"> 58.502652 </td>
   <td style="text-align:right;"> 39,341,989 </td>
   <td style="text-align:right;"> 39,341,989 </td>
   <td style="text-align:right;"> 55,464,043 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Ownership_Areas_Excluded_from_AFLB </td>
   <td style="text-align:right;"> 668,209 </td>
   <td style="text-align:right;"> 0.704817 </td>
   <td style="text-align:right;"> 403,404 </td>
   <td style="text-align:right;"> 39,745,393 </td>
   <td style="text-align:right;"> 55,060,639 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Non_Forest_and_Non_Productive_Forest </td>
   <td style="text-align:right;"> 40,054,531 </td>
   <td style="text-align:right;"> 42.248927 </td>
   <td style="text-align:right;"> 4,306,612 </td>
   <td style="text-align:right;"> 44,052,005 </td>
   <td style="text-align:right;"> 50,754,027 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Linear_Features </td>
   <td style="text-align:right;"> 1,727,381 </td>
   <td style="text-align:right;"> 1.822016 </td>
   <td style="text-align:right;"> 1,119,885 </td>
   <td style="text-align:right;"> 45,171,890 </td>
   <td style="text-align:right;"> 49,634,142 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LANDBASE SUMMARY - AFLB </td>
   <td style="text-align:right;"> 49,634,142 </td>
   <td style="text-align:right;"> 52.353359 </td>
   <td style="text-align:right;"> 45,171,890 </td>
   <td style="text-align:right;"> 45,171,890 </td>
   <td style="text-align:right;"> 49,634,142 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Riparian_Buffers </td>
   <td style="text-align:right;"> 28,298,289 </td>
   <td style="text-align:right;"> 29.848617 </td>
   <td style="text-align:right;"> 2,563,383 </td>
   <td style="text-align:right;"> 47,735,273 </td>
   <td style="text-align:right;"> 47,070,759 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Physical_Inoperable </td>
   <td style="text-align:right;"> 29,871,235 </td>
   <td style="text-align:right;"> 31.507737 </td>
   <td style="text-align:right;"> 10,127,617 </td>
   <td style="text-align:right;"> 57,862,890 </td>
   <td style="text-align:right;"> 36,943,142 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Merchantability </td>
   <td style="text-align:right;"> 23,088,348 </td>
   <td style="text-align:right;"> 24.353248 </td>
   <td style="text-align:right;"> 6,267,020 </td>
   <td style="text-align:right;"> 64,129,911 </td>
   <td style="text-align:right;"> 30,676,121 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LANDBASE SUMMARY - THLB </td>
   <td style="text-align:right;"> 30,676,121 </td>
   <td style="text-align:right;"> 32.356719 </td>
   <td style="text-align:right;"> 64,129,911 </td>
   <td style="text-align:right;"> 64,129,911 </td>
   <td style="text-align:right;"> 30,676,121 </td>
  </tr>
</tbody>
</table>


